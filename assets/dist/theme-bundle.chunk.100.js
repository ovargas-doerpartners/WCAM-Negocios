"use strict";(self.webpackChunkpapathemes_supermarket=self.webpackChunkpapathemes_supermarket||[]).push([[100],{72100:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var i=r(4621),a=r(57792),o=r(13228),n=r(71779),s=r(84468),c=r(86513),h=r(79823),u=r(38221),d=r.n(u),p=r(88835),l=r(56526),g=r(33270),y=function(){function e(e){this.doSearch=d()(this.doSearch.bind(this),500),this.onInput=this.onInput.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this),this.onClear=this.onClear.bind(this),this.onStateChange=this.onStateChange.bind(this),this.options=e,this.$body=g("body"),this.$input=g("[data-search-in-category]"),this.$form=this.$input.closest("form"),this.$clear=this.$form.find("[data-clear]").hide(),this.originalPathname=window.location.pathname,e&&e.facetedSearch&&(this.options.facetedSearch.updateViewCallback=this.updateViewFacetedSearch.bind(this)),this.bindEvents();var t=p.parse(l.A.getUrl(),!0);t.query.q&&(this.$input.val(t.query.q),this.$clear.show(),g(window).trigger("statechange"))}var t=e.prototype;return t.destroy=function(){this.unbindEvents()},t.bindEvents=function(){this.$input.on("input",this.onInput),this.$form.on("submit",this.onFormSubmit),this.$clear.on("click",this.onClear),0===g("#facetedSearch").length&&g(window).on("statechange",this.onStateChange)},t.unbindEvents=function(){this.$input.off("input",this.onInput),this.$form.off("submit",this.onFormSubmit),this.$clear.off("click",this.onClear),g(window).off("statechange",this.onStateChange)},t.onFormSubmit=function(){return!1},t.onClear=function(e){e.preventDefault(),this.$clear.hide(),this.$input.val("").trigger("input")},t.onInput=function(e){this.doSearch(g(e.target).val())},t.onStateChange=function(){var e=this,t=l.A.getUrl(),r=p.parse(t,!0),a=r.query.search_query||r.query.search_query_adv||r.query.q,o={template:{productListing:"category/product-listing",sidebar:"category/sidebar"}};a&&(r.query.search_query_adv=a,delete r.query.search_query,delete r.query.q,delete r.query.category,this.options.context.categoryId?r.query["category[]"]=this.options.context.categoryId:delete r.query["category[]"],this.options.context.themeSettings.categorypage_search_subs&&(r.query.searchsubs="ON"),t="/search.php?"+l.A.buildQueryString(r.query),o={template:{productListing:"papa-supermarket/search-in-category/product-listing",sidebar:"papa-supermarket/search-in-category/sidebar"},showMore:"search/show-more"}),this.$form.addClass("loading"),this.$body.trigger("beforerequest.searchincategory"),i.FH.getPage(t,o,function(t,r){if(e.$form.removeClass("loading"),t)throw new Error(t);e.$body.trigger("beforeupdate.searchincategory"),r&&e.options.searchCallback&&e.options.searchCallback(r),e.$body.trigger("afterupdate.searchincategory")})},t.doSearch=function(e){if(0===e.length){this.$clear.hide();var t=l.A.removeParams(l.A.getUrl(),["q","search_query","search_query_adv","category","page"]);l.A.goToUrl(t)}else if(e.length>=3){this.$clear.show();var r=l.A.removeParams(l.A.getUrl(),["q","search_query","search_query_adv","page"]);r=l.A.replaceParams(r,{q:e}),l.A.goToUrl(r)}},t.updateViewFacetedSearch=function(){var e=this,t=this.options.facetedSearch,r=l.A.getUrl(),a=t.requestOptions,o=p.parse(r,!0),n=o.query.q||o.query.search_query,s=["_bc_fsnf","search_query","q","sort","limit","mode","page"],c=Object.keys(o.query).filter(function(e){return-1===s.indexOf(e)});"/search.php"===window.location.pathname&&0===c.length?(this.$input.val(""),this.$clear.hide(),r=l.A.removeParams(r,[].concat(c,["search_query","q","_bc_fsnf"])).replace("/search.php",this.originalPathname),window.history.replaceState({},document.title,r)):n?("/search.php"===window.location.pathname&&(o.query.q=n,delete o.query.search_query,Number(o.query.category)===this.options.context.categoryId&&delete o.query.category,window.history.replaceState({},document.title,this.originalPathname+"?"+l.A.buildQueryString(o.query))),delete o.query.q,o.query.search_query=n,o.query.category||(o.query.category=this.options.context.categoryId),r="/search.php?"+l.A.buildQueryString(o.query),a={template:{productListing:"papa-supermarket/search-in-category/product-listing",sidebar:"papa-supermarket/search-in-category/sidebar"},showMore:"search/show-more"}):this.$input.val(""),g(t.options.blockerSelector).show(),this.$form.addClass("loading"),this.$body.trigger("beforerequest.searchincategory"),i.FH.getPage(r,a,function(r,i){if(g(t.options.blockerSelector).hide(),e.$form.removeClass("loading"),r)throw new Error(r);e.$body.trigger("beforeupdate.searchincategory"),t.refreshView(i),e.$body.trigger("afterupdate.searchincategory")})},e}(),m=r(33270);function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}var b=function(e){function t(t){var r;return(r=e.call(this,t)||this).validationDictionary=(0,n.i)(t),r}var r,a;a=e,(r=t).prototype=Object.create(a.prototype),r.prototype.constructor=r,f(r,a);var u=t.prototype;return u.onReady=function(){(0,c.lA)(this.context),this.context&&(this.context.themeSettings.show_bulk_order_mode||this.context.useBulkOrder)&&(this.bulkOrder=(0,h.A)(this.context)),m("#facetedSearch").length>0?this.initFacetedSearch():(this.onSortBySubmit=this.onSortBySubmit.bind(this),i.JL.on("sortBy-submitted",this.onSortBySubmit)),(0,s.A)(),"show"===this.context.themeSettings.categorypage_search&&this.initSearchInCategory()},u.destroy=function(){this.searchInCategory&&this.searchInCategory.destroy(),this.facetedSearch?this.facetedSearch.destroy():i.JL.off("sortBy-submitted",this.onSortBySubmit)},u.initSearchInCategory=function(){var e=this;this.searchInCategory=new y({context:this.context,facetedSearch:this.facetedSearch,searchCallback:function(t){m("#product-listing-container").html(t.productListing),e.bulkOrder&&e.bulkOrder.reinit(),(0,s.A)(),m("body").triggerHandler("compareReset"),m("html, body").animate({scrollTop:0},100)}})},u.initFacetedSearch=function(){var e=this,t=this.validationDictionary,r=t.price_min_evaluation,i=t.price_max_evaluation,a=t.price_min_not_entered,n=t.price_max_not_entered,s=t.price_invalid_value,c=m("#product-listing-container"),h=m("#faceted-search-container"),u={config:{category:{shop_by_price:!0,products:{limit:this.context.categoryProductsPerPage}}},template:{productListing:"category/product-listing",sidebar:"category/sidebar"},showMore:"category/show-more"};this.facetedSearch=new o.A(u,function(t){c.html(t.productListing),h.html(t.sidebar),e.bulkOrder&&e.bulkOrder.reinit(),m("body").triggerHandler("compareReset"),m("html, body").animate({scrollTop:0},100)},{validationErrorMessages:{onMinPriceError:r,onMaxPriceError:i,minPriceNotEntered:a,maxPriceNotEntered:n,onInvalidPrice:s}})},t}(a.A)}}]);
//# sourceMappingURL=theme-bundle.chunk.100.js.map
